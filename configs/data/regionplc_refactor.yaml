_target_: src.data.regionplc_refactor.datamodule.RegionPLCDataModule

train_dataset:
  _target_: src.data.regionplc_refactor.scannet_dataset.ScanNetDataset
  _partial_: True
  root_path: /datasets/regionplc
  training: True
  class_names: ${model.net.model_cfg.CLASS_NAMES}
  dataset_cfg:
    DATASET: ScanNetDataset
    DATA_PATH: ${data.train_dataset.root_path}
    OSS_PATH: "sh40:s3://PublicDatasets/scannetv2"
    base_class_idx: [0, 1, 2, 3, 4, 6, 7, 8, 10, 11, 13, 14, 15, 17, 18]
    ignore_class_idx: [19]
    valid_class_idx:
      [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18]
    novel_class_idx: [5, 9, 12, 16]

    COLLATE_FN: collate_batch_indoor
    MIN_SPATIAL_SCALE: 128

    DATA_SPLIT:
      train: train
      test: val
      data_suffix: .pth
      root: ./src/data/metadata/split_files

    IGNORE_LABEL: -100

    DATA_AUG:
      AUG_LIST: [scene_aug, elastic, crop, shuffle]
      scene_aug:
        scaling_scene:
          enabled: False
          p: 1.0
          value: [0.9, 1.1]

        rotation:
          p: 1.0
          value: [0.0, 0.0, 1.0]

        jitter: True
        color_jitter: True

        flip:
          p: 0.5

        random_jitter:
          enabled: False
          value: 0.01
          accord_to_size: False
          p: 1.0

      elastic:
        enabled: True
        value: [[6, 40], [20, 160]]
        apply_to_feat: False
        p: 1.0

      crop:
        step: 32

      shuffle: True

    DATA_PROCESSOR:
      repeat: 4
      rgb_norm: True
      point_range: 200000000
      voxel_scale: 50 # voxel_size = 1 / scale, scale 25(0.02m)
      cache: True
      max_npoint: 250000
      full_scale: [128, 512]
      voxel_mode: 4
      xyz_norm: False
      xyz_as_feat: True
      rgb_as_feat: True

      PROCESS_LIST: []

    NEED_SV: False
    CAPTION_INFO:
      KEY: [SCENE, VIEW, ENTITY]

      SCENE:
        ENABLED: False
        CAPTION_PATH: text_embed/caption.json

      VIEW:
        ENABLED: True
        CAPTION_PATH: text_embed/caption_detic-template_and_kosmos_125k_iou0.2.json
        IMAGE_CORR_PATH: scannet_caption_idx_detic-template_and_kosmos_125k_iou0.2.pkl
        SELECT: ratio
        NUM: 1
        RATIO: 0.2
        SAMPLE: 1
        GATHER_CAPTION: False

      ENTITY:
        ENABLED: False
        CAPTION_PATH: text_embed/caption_2d_intersect_v3.json
        IMAGE_CORR_PATH: scannetv2_matching_idx_intersect_v3
        SELECT: ratio
        NUM: 1
        RATIO: 1.0

      CAPTION_CORR_PATH_IN_ONE_FILE: True

val_dataset:
  _target_: src.data.regionplc_refactor.scannet_dataset.ScanNetDataset
  _partial_: True
  root_path: /datasets/regionplc
  training: False
  class_names: ${model.net.model_cfg.CLASS_NAMES}
  dataset_cfg:
    DATASET: ScanNetDataset
    DATA_PATH: ${data.val_dataset.root_path}
    OSS_PATH: "sh40:s3://PublicDatasets/scannetv2"

    COLLATE_FN: collate_batch_indoor
    MIN_SPATIAL_SCALE: 128

    DATA_SPLIT:
      train: train
      test: val
      data_suffix: .pth
      root: ./src/data/metadata/split_files

    IGNORE_LABEL: -100

    DATA_AUG:
      AUG_LIST: [scene_aug, elastic, crop, shuffle]
      scene_aug:
        scaling_scene:
          enabled: False
          p: 1.0
          value: [0.9, 1.1]

        rotation:
          p: 1.0
          value: [0.0, 0.0, 1.0]

        jitter: True
        color_jitter: True

        flip:
          p: 0.5

        random_jitter:
          enabled: False
          value: 0.01
          accord_to_size: False
          p: 1.0

      elastic:
        enabled: True
        value: [[6, 40], [20, 160]]
        apply_to_feat: False
        p: 1.0

      crop:
        step: 32

      shuffle: True

    DATA_PROCESSOR:
      repeat: 4
      rgb_norm: True
      point_range: 200000000
      voxel_scale: 50 # voxel_size = 1 / scale, scale 25(0.02m)
      cache: True
      max_npoint: 250000
      full_scale: [128, 512]
      voxel_mode: 4
      xyz_norm: False
      xyz_as_feat: True
      rgb_as_feat: True

      PROCESS_LIST: []

    NEED_SV: False

batch_size: 4
num_workers: 2
