_target_: src.data.scannet.dataset.ScanNetDataset
_partial_: true
data_dir: /datasets/scannet_hf
caption_dir: /datasets/regionplc_converted/
caption_subset: detic-template_and_kosmos_125k_iou0.2
object_num_max: 300
split: train
transforms:
  - type: Copy
    keys_dict:
      coord: origin_coord
  - type: MeanShift
  - type: RandomFlip
    p: 0.5
  - type: RandomRotate
    p: 1.0
    angle: [-1, 1]
    center: [0, 0, 0]
    axis: z
  - type: ChromaticJitter
    p: 1.0
    std: 0.007
  - type: ElasticDistortion
  - type: SphereCrop
    point_max: 250000
    mode: random
  - type: NormalizeColor
  - type: ToTensor
  - type: Collect
    keys:
      [
        "origin_coord",
        "coord",
        "color",
        "segment",
        "instance",
        "binary",
        "caption_data",
        "origin_idx",
        "pc_count",
      ]
    offset_keys_dict:
      offset: coord
    feats_keys: ["color", "coord"]
base_class_idx: [0, 1, 2, 3, 4, 6, 7, 8, 10, 11, 13, 14, 15, 17, 18]
ignore_class_idx: [19]
novel_class_idx: [5, 9, 12, 16]
ignore_label: -100

collate_fn:
  _target_: src.data.collate.point_collate_regionplc_fn
  _partial_: true
  grid_size: 0.02

# processor
repeat: 4
rgb_norm: True
point_range: 200000000
voxel_scale: 50 # voxel_size = 1 / scale, scale 25(0.02m)
max_npoint: 250000
full_scale: [128, 512]
xyz_as_feat: True
rgb_as_feat: True
min_spatial_shape: 128

# caption cfg
caption_cfg:
  ENABLED: True
  CAPTION_PATH: caption/caption_detic-template_and_kosmos_125k_iou0.2.json
  IMAGE_CORR_PATH: image_corr/scannet_caption_idx_detic-template_and_kosmos_125k_iou0.2.pkl
  SELECT: ratio
  NUM: 1
  RATIO: 0.2
  SAMPLE: 1
  GATHER_CAPTION: False

text_embed_path: text_embed/scannet_clip-ViT-B16_id.pth

# compile model for faster training with pytorch 2.0
clip_encoder:
  model_id: ViT-B/16
  text_dim: 512
