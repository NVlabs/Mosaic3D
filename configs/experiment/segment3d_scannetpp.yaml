general:
  train_mode: false
  task: "instance_segmentation"
  seed: null
  checkpoint: "ckpts/segment3d.ckpt"
  backbone_checkpoint: null
  freeze_backbone: false # train only last layer
  linear_probing_backbone: false
  train_on_segments: true
  eval_on_segments: false
  filter_out_instances: false
  save_visualizations: true
  visualization_dir: "visuals/${general.experiment_name}"
  visualization_point_size: 20
  decoder_id: -1
  export: false
  use_dbscan: true
  ignore_class_threshold: 100
  project_name: segment3d_scannetpp
  workspace: jonasschult
  experiment_name: segment3d_scannetpp
  num_targets: 19
  add_instance: true
  dbscan_eps: 0.05
  dbscan_min_points: 5
  export_threshold: 0.0001
  reps_per_epoch: 1
  on_crops: false
  scores_threshold: 0.0
  iou_threshold: 1.0
  area: 5
  eval_inner_core: -1 # disabled
  topk_per_image: -1
  ignore_mask_idx: []
  max_batch_size: 99999999
  save_dir: saved/${general.experiment_name}
  test_scene: "samples/1Ffe5jcItYmZHpb875Z3V48wsqsAAnDp9"
  gpus: 1

data:
  voxel_size: 0.02
  in_channels: 3
  num_labels: 20
  remove_small_group: 15

model:
  _target_: src.models.networks.segment3d.mask3d_no_aux.Mask3D_no_aux

  # transformer parameters
  hidden_dim: 128
  dim_feedforward: 1024
  num_queries: 400
  num_heads: 8
  num_decoders: 3
  dropout: 0.0
  pre_norm: false
  use_level_embed: false
  normalize_pos_enc: true
  positional_encoding_type: "fourier"
  gauss_scale: 1.0
  hlevels: [0, 1, 2, 3]

  # queries
  non_parametric_queries: true
  random_query_both: false
  random_normal: false
  random_queries: false
  use_np_features: false

  # sampling
  sample_sizes: [200, 800, 3200, 12800, 51200]
  max_sample_size: false # change false means sampling activated

  shared_decoder: true
  num_classes: 2
  train_on_segments: ${general.train_on_segments}
  scatter_type: "mean"

  voxel_size: ${data.voxel_size}

  config:
    backbone:
      _target_: src.models.networks.segment3d.res16unet.Res16UNet34C
      config:
        dialations: [1, 1, 1, 1]
        conv1_kernel_size: 5
        bn_momentum: 0.02
      # depends on normals, color, raw_coordinates
      # varies from 3 to 9
      in_channels: ${data.in_channels}
      out_channels: ${data.num_labels}
      out_fpn: true

hydra:
  run:
    dir: saved/hydra_logs/${now:%Y-%m-%d}/${now:%H-%M-%S}
  sweep:
    dir: saved/hydra_logs/${now:%Y-%m-%d}/${now:%H-%M-%S}
    # dir: ${general.save_dir}
    subdir: ${hydra.job.num}_${hydra.job.id}
