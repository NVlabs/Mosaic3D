_target_: src.models.regionplc_refactor.litmodule.RegionPLCLitModule

optimizer:
  _target_: src.models.optimization.build_optimizer
  _partial_: true
  optim_cfg:
    BATCH_SIZE_PER_GPU: 4
    NUM_EPOCHS: 128
    LR: 4e-3
    SCHEDULER: adam_onecycle
    OPTIMIZER: adam_onecycle
    WEIGHT_DECAY: 0.0001
    MOMENTUM: 0.9
    STEP_EPOCH: 50
    MULTIPLIER: 0.1
    CLIP_GRAD: False
    PCT_START: 0.39
    DIV_FACTOR: 1
    MOMS: [0.95, 0.85]

scheduler:
  _target_: src.models.optimization.build_scheduler
  _partial_: true
  last_epoch: -1
  optim_cfg: ${model.optimizer.optim_cfg}

scheduler_interval: step

net:
  backbone_cfg:
    in_channel: 6
    mid_channel: 16
    block_reps: 2
    block_residual: true
    custom_sp1x1: true
    num_blocks: 7
    grid_size: 0.02

  adapter_cfg:
    text_channel: 512
    num_layers: 2
    last_norm: true

  enable_binary_head: true
  binary_head_cfg:
    ignore_label: ${data.train_dataset.ignore_label}
    in_channel: ${model.net.backbone_cfg.mid_channel}
    block_reps: ${model.net.backbone_cfg.block_reps}
    block_residual: ${model.net.backbone_cfg.block_residual}
    binary_thresh: 0.5
    hook_feature_list:
      [
        "unet.blocks.block1",
        "unet.u.blocks.block1",
        "unet.u.u.blocks.block1",
        "unet.u.u.u.blocks.block1",
        "unet.u.u.u.u.blocks.block1",
        "unet.u.u.u.u.u.blocks.block1",
        "unet.u.u.u.u.u.u.blocks.block1",
      ]
    custom_sp1x1: true
    detach: true
    loss_weight: 1.0
    voxel_loss: false

  caption_head_cfg:
    ignore_label: ${data.train_dataset.ignore_label}
    feat_norm: true
    logit_scale: 100.0
    logit_learnable: true
    loss_weight: 0.5
    novel_grad_only: true

  task_head_cfg:
    in_channel: ${model.net.backbone_cfg.mid_channel}
    text_embed_path: ${data.train_dataset.data_dir}/text_embed/scannet_clip-ViT-B16_id.pth
    ignore_label: ${data.train_dataset.ignore_label}
    feat_norm: false
    loss_weight: 1.0
    logit_scale: 1.0
    logit_learnable: false
    base_class_idx: ${data.train_dataset.base_class_idx}
    novel_class_idx: ${data.train_dataset.novel_class_idx}
    ignore_class_idx: ${data.train_dataset.ignore_class_idx}
    eval_only: false

# compile model for faster training with pytorch 2.0
text_encoder:
  name: CLIP
  backbone: ViT-B/16

compile: false
